#!/usr/bin/python
'''Sum-up all lines in a text file containing numbers (by other words on the same line)
'''
# Copyright 2011 Edward Delaporte <edthedev@gmail.com>
# Licensed under the University of Illinois / NCSA Open Source License 
# http://www.opensource.org/licenses/UoI-NCSA 
# Created: 2011-08-04

import optparse
import re

parser = optparse.OptionParser()
parser.add_option('-w', '--by-word', default=True)
(options, args) = parser.parse_args()

word_count = {}
number_re = re.compile('\d+\.*\d*')

def shouldIgnore(line):
	ignore = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Updated:', 'In-Reply-To:', 'Subject:']
	for term in ignore:
		if term in line:
			return True 
	return False

total = 0
for filename in args:
	f = open(filename, 'r')
	content = f.readlines()
	f.close()

	for line in content:
		if not shouldIgnore(line):
			matches = number_re.findall(line)
			if len(matches) > 0:
				count = float(matches[0])
				total += count
				if options.by_word:
					# print matches
					words = line.split(' ')
					for word in words:
						clean_word = word.strip('\n')
						try:
							float(clean_word)
						except:
							if word_count.has_key(clean_word):
								word_count[clean_word] += count
							else:
								word_count[clean_word] = count

print "Summary"
for key in word_count:
	print "'%s': %d" % (key, word_count[key])
print "Line Total: %d" % total
